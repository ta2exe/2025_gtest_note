
次はここから（第4章）

# 第2部 ディープラーニングの冒険

## 第15話 ペンギンさんの置き土産と、脳のしくみ

オリオン星雲からぶじに森へ帰ってきてから、すこしの時間がながれました。
イライザさんは、みんなにお礼を言うと、自分の故郷の牧場へと帰っていきました。「伝説のおいしい草を探す旅の途中だったのよ」と、すこし恥ずかしそうに笑っていました。森が気に入ったようで、「またいつでも遊びに来るわね」と手を振っていたのが印象的です。

森にはまた、いつもの平和な日常がもどってきました。

「よいしょ、よいしょ…」

うさぎさんは、お店をひらく予定の大きな木のまわりを、一生懸命お掃除しています。
リスくんは、新しいお店の看板に描く、かわいいクッキーのイラストを何枚もスケッチしています。
そしてくまたんは…というと、空を見上げてぼーっとしていました。

「くまたん、手がとまってるわよー！」
うさぎさんの声に、くまたんははっと我にかえります。

「ご、ごめん！ でも、なんだかペンギンさんがいなくなってから、AIのお勉強も一休みで、ちょっと寂しいなって…」

ペンギンさんは、イライザさんを助けたあとすぐに、南極にあるDeepPenguin社の緊急連絡をうけて、大いそぎで帰ってしまったのです。会社のCEO（最高経営責任者）であるピーターというペンギンが急死してしまい、その後継者としてペンギンさんが新しいCEOになったのだとか。とても忙しくなってしまい、しばらくは森にもどれない、という手紙が先日とどいたばかりでした。

「たしかに、ペンギンさんのAI教室は楽しかったわね」
うさぎさんも、手を休めて空を見上げます。
「でもね、大丈夫よ。わたしのクッキー作りのお師匠さまである、おばあちゃんがもうすぐこの森に帰ってくるの。とっても物知りだから、きっと色々相談に乗ってくれるわ」

「へぇ、うさぎさんのおばあちゃん！」
くまたんが目を輝かせた、その時です。
「そうだ！ ペンギンさん、ぼくたちにこれを残していってくれたじゃないか！」
くまたんは、自分の家に駆け込むと、キラキラ光る一枚のディスクを持って戻ってきました。ペンギンさんが最後に手渡してくれた、「AI自習用ホログラムディスク」です。

さっそくディスクを切り株の上に置くと、ぽわん、と光がともり、手のひらサイズのペンギンさんのホログラムが浮かび上がりました。
『やあ、みんな！ 私がいない間も、これでしっかり勉強するんだぞ！ 今日は、いよいよディープラーニングの心臓部、「ニューラルネットワーク」についてだ！』

三人は、久しぶりに会う（ホログラムですが）ペンギンさんの姿に、わっと歓声をあげました。

『ニューラルネットワークというのは、私たちの脳の神経回路を真似たものだ。一番シンプルなのが「**単純パーセプトロン**」。これは、いくつかの入口から情報を受け取って、その合計がある基準を超えたら、出口に「よし！（1）」という信号を送る、一つの脳細胞みたいなものさ』

ホログラムのペンギンさんは、空中に簡単な図を描いて説明します。
『そして、この脳細胞（パーセプトロン）を、たくさん、何層にも並べたものが「**多層パーセプトロン**」、つまりニューラルネットワークなんだ。入口である「**入力層**」、出口である「**出力層**」、そしてその間にあるたくさんの「**隠れ層**」でできている』

「隠れ層…なんだかわくわくする名前だね！」
くまたんが言うと、ホログラムのペンギンさんは得意げにうなずきます。

『だが、この計算はものすごく大変なんだ。普通のコンピューターの脳みそである**CPU**だけだと、時間がかかりすぎてしまう。そこで、画像処理が得意な**GPU**という脳みそをたくさん並べて、みんなで一気に計算する。我々DeepPenguin社は、このGPUを使った高速計算が、世界で一番得意なんだ！』

『もちろん、我々だけが頑張っているわけじゃない。人間の世界では、Googleという会社がディープラーニング専用の**TPU**という超天才的な脳みそを作って、AIの進化をぐんぐん加速させているんだ』

『…そして、もっと気がかりな噂もある』と、ペンギンさんは少しだけ声をひそめました。
『我々のライバル企業、あの悪名高いDeepAppendix社が、全てを凌駕する『**DAPU**』という独自のチップを極秘に開発している、という噂だ。もし本当なら、とんでもない計算力で、何か良からぬことを企んでいるのかもしれない…。この前に遭遇した謎の宇宙船も、彼らの仕業である可能性が捨てきれないな…』


ホログラムのペンギンさんは、きゅっと拳を握りしめました。どうやら、ライバル会社との間には、いろいろと複雑な事情があるようです。

三人は、難しい話はわかりませんでしたが、AIの奥深さと、ペンギンさんたちの熱い戦いの世界を垣間見て、胸がどきどきするのでした。

「おばあちゃんが帰ってきたら、このお話もしてあげなくっちゃ！」
うさぎさんがにっこり笑いました。
新しい学びと、もうすぐやってくる新しい出会いの予感に、森の空気はきらきらと輝いていました。

（第16話につづく）

## 第16話 おばあちゃんの坂道と、ニューロンのやる気スイッチ

ホログラムのペンギンさんによるニューラルネットワークの解説は、とても分かりやすいものでした。
しかし、話が進むにつれて、三人の頭の上には、だんだんと「？」マークが浮かび始めます。

『いいかい？ たくさんのニューロン（脳細胞）が、前の層からたくさんの情報を受け取って、それを次の層へ…』

「うーん…」うさぎさんが、こまり顔で首をかしげました。
「ペンギンさんの説明はわかるのだけど…たくさんの情報を受け取ったニューロンは、そのあとどうするのかしら？ 全部ごちゃ混ぜになっちゃわない？」

「たしかに！ 全部足し算するだけだと、どんどん大きな数字になるだけだよね？」
くまたんも、腕を組んで考え込んでしまいます。

三人が難しい顔をしている、まさにその時でした。
森の小道の奥から、ゆっくりと、しかし確かな足取りで、だれかがこちらに近づいてくるのが見えました。

雪のように白く、うつくしい縞模様をもった、一頭のホワイトタイガーです。
先日うさぎさんが話していた、クッキー作りのお師匠さまである、おばあちゃんでした。

「ただいま、うさぎ。あら、お友だちも一緒だったのかい」
「おばあちゃん！ おかえりなさい！」

うさぎさんが駆け寄ると、ホワイトタイガーおばあちゃんは優しくその頭をなでました。
くまたんとリスくんが挨拶をすると、おばあちゃんはにっこり笑って、ふう、と一つ息をつきます。

「やれやれ、ここまで来る森の坂道は、なかなかの『勾配』じゃわい。年寄りにはこたえるねえ」

「勾配…？」
その言葉に、三人と、そしてホログラムのペンギンさんもぴくりと反応しました。

「おや、AIのお勉強かい？ 面白いことをしているね」
おばあちゃんは、元大学の数学の先生。AIの話にも興味津々です。
うさぎさんが先ほどの疑問を話すと、おばあちゃんは「なるほどね」とうなずきました。

「それは、ニューロンの『やる気スイッチ』の話じゃな。数学の言葉で言うと『**活性化関数**』というもんじゃよ」

おばあちゃんは、地面に杖で一本の線を描きました。
「ニューロンは、前の層から受け取った情報を、ぜんぶ正直に次の層に伝えるわけじゃない。『この情報は重要だから通す』とか、『これはあまり大事じゃないから、少しだけ伝える』とか、そういう判断をしているんじゃ。その判断、つまりニューロンをどれくらい『活性化』させるかを決めるのが、活性化関数の役割さ」

「やる気スイッチ…！」

「そうじゃ。そして、そのスイッチにもいろんな種類がある。例えば…」
おばあちゃんは、うさぎさんの焼いたクッキーを一枚手に取り、にこりと笑います。
「『このクッキーは100点満点中、何点？』と聞かれたら、0点から100点の間のどこかで答えるじゃろ？ こんな風に、答えを特定の範囲にぎゅっと押し込めるのが『**シグモイド関数**』や『**tanh関数**』じゃ。特に出力を0から1の間にしたい時によく使われる」

しかし、とおばあちゃんは悪戯っぽく笑いました。
「昔、海外に住んどる友人でな、くろやぎという名の、それはそれは変わった登山家がおったんじゃが…」
おばあちゃんは、シグモイド関数の特徴である、なだらかなS字カーブを地面に描きました。
「そのくろやぎさん、なぜか坂道の『勾配』、つまり傾きがゆるやかすぎると、『手応えがない！』と言って、登るのをやめてしまう特異な体質でのう。AIも、そのくろやぎさんに少し似とるんじゃ」
「ええっ！？」
「このゆるやかな部分が多すぎると、AIは学習の途中で『変化が小さすぎて、どっちに進めばいいかわからない！』とやる気をなくしてしまうんじゃ。これを『**勾配消失問題**』と言う。せっかくの学びが、消えてなくなってしまう、とても重要な問題じゃよ」

「ええっ、AIがやる気をなくしちゃうの！？」

「そこで、もっと単純で、やる気に満ちたスイッチが考え出された」
おばあちゃんは、今度はカクンと折れ曲がった直線を描きます。
「『**ReLU関数**』じゃ。これは単純明快。『入力がマイナスなら、やる気ゼロ(0)！』『プラスなら、そのやる気をそのまま伝える！』という、とっても元気なスイッチなんじゃ。シンプルだから計算も速いし、勾配消失も起きにくい。今のディープラーニングでは、このReLU関数がとてもよく使われとるよ」

三人は、目の前の坂道と、おばあちゃんの話すAIのやる気スイッチの話を頭の中で重ね合わせ、深くうなずきました。
ただの数式だと思っていたものが、まるで生き物のように、やる気を出したり、なくしたりするなんて。

「おばあちゃん、すごい！ まるで魔法みたい！」
くまたんが目を輝かせると、おばあちゃんは「数学は、世界の不思議を解き明かす魔法じゃよ」と、優しく笑うのでした。

（第17話につづく）

## 第17話 人気クッキーと、AIの「しまった！」

ホワイトタイガーおばあちゃんの、まるで魔法のような数学の話に、三人はすっかり引き込まれていました。

「でも、おばあちゃん」
神経質なリスくんが、少し心配そうに尋ねます。
「さっきのReLU関数だと、やる気がマイナスになったらずっとゼロのままなんでしょう？ そのニューロン、もう二度とやる気を取り戻せないまま、さぼっちゃったりしないの？」

「おやおや、いいところに気がついたね」
おばあちゃんは、感心したように目を細めました。
「確かに、そうなってしまう可能性もある。そこで考え出されたのが、『**Leaky ReLU関数**』じゃ」
「りーきー？」
「そう、『漏れる』という意味じゃな。やる気がマイナスになっても完全にゼロにはせず、『ほんのすこーしだけ、やる気を残しておく』という仕組みなんじゃ。わしの友人のくろやぎさんも、なだらかな坂道で文句を言いながらも、ぴたりと止まらず、のろのろと足を動かしはするからのう。あれにそっくりじゃ」
その優しい工夫に、リスくんはほっと胸をなでおろしました。

「そうだわ！ AIに、わたしのクッキーショップのメニューも考えてもらえないかしら？」
話を聞いていたうさぎさんが、ぱっと顔を輝かせました。
テーブルには、うさぎさんが試作した「いちごクッキー」「ちょこクッキー」「まっちゃクッキー」の三種類が並んでいます。
「この中で、どれが一番人気になるか、AIに予測してほしいの！」

「ほう、それは面白い問題じゃな」
おばあちゃんは、うなずきます。
「AIに予測させるには、まずそれぞれのクッキーが、どれくらいの確率で『一番』に選ばれるかを計算する必要がある。三つの中から『ただ一つの一番』を選ぶ。こういう時に役立つのが、『**ソフトマックス関数**』というやる気スイッチじゃ」

おばあちゃんは、三種類のクッキーの人気投票の結果（ちょこ:15票, いちご:10票, まっちゃ:5票）を例に説明します。
「ソフトマックス関数は、このバラバラの得点を、『ちょこが一番人気の確率50%』『いちごが一番人気の確率33%』『まっちゃが一番人気の確率17%』というように、全部足すとちゃんと100%になる確率に変換してくれるんじゃよ」

「すごい！ これならAIも分かりやすいね！」
くまたんが感心していると、おばあちゃんはにやりと笑いました。
「さて、ここからが本番じゃ。この確率を使って、AIに『次のお客さんは、きっとちょこクッキーを選ぶじゃろう』と予測させてみよう」

そこへ、ちょうどお散歩中の狸さんが通りかかりました。
狸さんが手に取ったのは…なんといちごクッキー！

「あっ、はずれちゃった…」
うさぎさんが、しょんぼりします。

「いいんじゃよ、うさぎ。AIにとって、この『はずれ』こそが、何よりの宝物なんじゃから」
「え？」
「AIは、自分の予測と、実際の結果が、どれくらい違っていたか…つまり、どれくらい『しまった！』と思ったかを、ちゃんと反省する。この、予測と現実の『ずれ』を計算するための数式が、『**誤差関数**』なんじゃ」

おばあちゃんは、地面に新しい数式を描き始めました。
「例えば、今回の誤差を数字にする『**交差エントロピー誤差**』というものさ。AIの学習とは、この『誤差』という数字を、試行錯誤を繰り返しながら、ゼロに近づけていく作業のことなんじゃよ」

AIが賢くなる仕組みの、その本質に触れた瞬間でした。
三人は、AIがただの計算機ではなく、まるで人間のように「反省」しながら成長していく健気な存在なのだと知り、ますますAIのことが好きになるのでした。

（第18話につづく）

## 第18話 おばあちゃんのリハビリ散歩と、一番近道な坂道

「AIの反省…なんだか、AIがとってもいじらしく思えてきちゃった」
うさぎさんが言うと、くまたんもリスくんも、うんうんと深くうなずきました。

「ふふふ、そうじゃろう」
ホワイトタイガーおばあちゃんは、満足そうに目を細めました。
「さて、わしはそろそろ、日課のリハビリ散歩に行くとしようかの。この辺りは坂道が多くて難儀じゃが、おかげで足腰の訓練にはちょうどいい」
そう言うおばあちゃんの足取りは、まだ少しだけおぼつかないように見えます。AIが見つけてくれた新薬のおかげで病気は治ったものの、長い入院生活で弱った足は、まだ完全には回復していないのでした。

「おばあちゃん、危ないわ！ わたしも一緒に行く！」
うさぎさんが慌てて駆け寄ると、おばあちゃんは「ありがとう」と優しく笑いました。

くまんたちも、もちろん一緒です。
うさぎさんのクッキーショップの予定地の周りは、緑豊かで美しいのですが、大小さまざまな坂道が続く、起伏の多い地形なのでした。

「さて、みんな。ここからわしの家まで帰るのに、一番楽な道はどこじゃと思う？」
おばあちゃんは、目の前に広がるいくつかのゆるやかな坂道を指しました。
「AIの学習も、これとそっくりなんじゃよ。AIの目的は、一番『誤差』が少ない場所…つまり、この丘の一番低い場所（正解）にたどり着くことじゃ」

「そのためには、坂道の傾き…つまり『勾配』を調べないといけないんじゃな」
おばあちゃんは、数学の先生の顔になります。
「AIは、今いる場所で、どちらの方角に下れば一番急な下り坂になっているかを、**微分**という計算で見つける。そして、そちらの方向に、ほんの少しだけ歩を進める。これを何回も何回も繰り返して、一番低い場所を探し当てるんじゃよ」

「へぇー！ AIも、一歩一歩進んでいくんだね！」

「そうじゃ。そして、その『誤差』の測り方にも、色々ある」
おばあちゃんは、散歩の途中で見つけた、二種類の花を指さしました。片方はそっくりなタンポポが二輪、もう片方は紫色のスミレです。
「例えば、AIに『仲間探し』をさせたい時。『このタンポポと、あのタンポポは仲間だよ』『このタンポポと、あのスミレは仲間じゃないよ』と教える学習方法がある。この時、AIは『仲間同士の距離（誤差）は近く、仲間じゃないものとの距離（誤差）は遠くなるように』と学習する。このための特別な誤差関数が、『**Triplet Loss**』じゃったりする」

三人は、AIがただ正解・不正解を学ぶだけでなく、モノ同士の「関係性」まで学んでいることに、深く感心しました。

「誤差を測り、坂道（勾配）を下り、正解に近づいていく…」
くまたんは、目の前の坂道をゆっくりと歩くおばあちゃんの姿と、健気に学習を続けるAIの姿を、心の中でそっと重ね合わせるのでした。

（第19話につづく）

## 第19話 リスくんの完璧な絵と、ドーナツの秘密

おばあちゃんのリハビリ散歩から戻ったみんなは、うさぎさんの淹れてくれた紅茶を飲みながら、休憩していました。
そんな中、リスくんは一人、先ほど散歩の途中で見つけたタンポポの絵を、真剣な顔で描いています。

「できた…！ ぼくの最高傑作だよ！」
リスくんが自信満々に見せてくれた絵は、それはもう驚くほど精密でした。花びらの枚数、葉っぱのギザギザ、茎の産毛の一本一本まで、写真のようにそっくりに描かれています。

「わあ、すごい！ まるで本物みたい！」
くまたんたちが褒めると、リスくんは得意げに胸を張ります。
しかし、うさぎさんが庭に咲いていた、少し形の違う別のタンポポを持ってきたとき、みんなは首をかしげました。リスくんの絵は、あまりにも「さっきのタンポポ」にそっくりすぎて、目の前にある「このタンポポ」には、なんだか見えなかったのです。

「うーん…どうしてだろう…」
リスくんは、しょんぼりと肩を落としました。

その様子を見ていたホワイトタイガーおばあちゃんは、優しく微笑みました。
「リスくん、それはAIの学習でも、まったく同じことが起きるんじゃよ。『**過学習**』といってな」
「か…がくしゅう？」
「そうじゃ。一つのデータ（お手本）をあまりに完璧に、それこそ産毛の一本まで覚えすぎてしまうと、少し違うだけの新しいデータに対応できなくなってしまうんじゃ。テストで100点を取れても、実社会では役に立たない頭でっかちと同じじゃな」

「ええっ、AIが頭でっかちに？」
「だから、AIにはわざと『そこそこに覚えなさい』と教える、特別な工夫が必要になる。それが『**正則化**』という技術なんじゃよ」

『いい加減に覚える』という言葉に、三人はますます混乱します。
おばあちゃんは、楽しそうに目を細めました。
「ふふふ、わしが大学で数学を教えていた頃の話をしてやろうかの。わしはな、学生に微積分を教えるときも、確率論を教えるときも、いつも『ドーナツ』を例えに使っておったんじゃ」
「ドーナツ！？」
「そうじゃ！ 坂道を転がるドーナツ、袋に入ったドーナツ、箱に並んだドーナツ…わしは昔からドーナツが大好きでな。趣味でよく揚げては、かじりながら位相幾何学の論文を読んだもんじゃ。あの穴のあいた形は、宇宙の真理じゃよ！」
おばあちゃんの意外な過去に、みんなは目を丸くします。

「正則化というのは、いわば『最高のドーナツレシピの極意』じゃな。AIが複雑になりすぎんように、ペナルティを課すんじゃよ」
おばあちゃんは、紅茶を一口飲みました。
「例えば、『レシピに余計な飾り付け（複雑なパラメータ）を増やすほど、シンプルさが失われる』というルールを決めておく。これが**L1正則化**（ラッソ回帰）や**L2正則化**（リッジ回帰）という考え方じゃ。特にL1は『本当にいらない飾り付けは、もうゼロにしちゃえ！』という厳しいルールで、レシピがすっきりするんじゃよ」

「へぇー！」
「そして、もっと面白い『正則化』がある」
おばあちゃんは、いたずらっぽく笑いました。
「『**ドロップアウト**』じゃ」
おばあちゃんは、テーブルの上のクッキーを、ニューラルネットワークのようないくつもの層に並べました。
「これが、たくさんのニューロン（ドーナツ）でできたAIの脳みそじゃとする。学習の最中に、この中からランダムにいくつかのドーナツをつまみあげて、『今日はお休み！』と言って、学習に参加させないんじゃ」
おばあちゃんが、本当にいくつかのクッキーを隠してしまいます。
「そうすると、残されたドーナツたちは、『あの子がいないなら、わしらが頑張らないと！』と、一つ一つがもっと賢く、たくましくなろうとする。特定の仲間に頼りすぎない、強いチームが出来上がる。これが、過学習を防ぐ、とても強力な技なんじゃ」

リスくんは、ぽんと手を打ちました。
「そっか…！ タンポポの細かいところを全部描くんじゃなくて、タンポポの『らしさ』だけを捉えれば、もっと生き生きとした、いろんなタンポポに見える絵が描けるんだ！」
リスくんの顔に、ぱあっと笑顔が戻りました。

AIにとっても、絵にとっても、時には「完璧すぎないこと」が、本当の賢さにつながるのだと、みんなは学ぶのでした。

（第20話につづく）

## 第20話 AI探偵の「しまった！」逆戻り大作戦

「そっかぁ、AIもわざと『いい加減』に覚えることがあるんだね。奥が深いなあ…」
リスくんの描いた、すこし不格好だけれど、生き生きとした新しいタンポポの絵を眺めながら、くまたんは深くうなずいていました。

その時、くまたんの目の端に、ホログラムのペンギンさんが表示している学習メニューの文字が映りました。
「『**誤差逆伝播法**』…？」
くまたんは、その文字を声に出して読み上げました。
「ごさ・ぎゃくでんぱ・ほう…！ なんだか、強そうな必殺技みたいな名前だね！ かっこいい！」

目をキラキラさせるくまたんを見て、ホワイトタイガーおばあちゃんは「ふふふ」と笑いました。
「確かに、AIにとっては最強の必殺技かもしれんね。AIが、どうやって自分の『しまった！』から学ぶか、その具体的な方法が、この誤差逆伝播法なんじゃよ」

「AIの反省方法、だね！」
「そうじゃ。AI探偵が、間違いの原因を過去にさかのぼって突き止める、『逆戻り大作戦』みたいなもんじゃな」
おばあちゃんは、みんなに伝言ゲームをしようと提案しました。

「わしが今から、『おいしいドーナツの揚げ方』の秘密のコツを、くまたんにだけこっそり教える。くまたんはリスくんに、リスくんはうさぎさんに、それを伝えておくれ」
おばあちゃんは、くまたんの耳にそっと何かをささやきました。
伝言は、くまたん、リスくんへと伝わっていきます。そして最後に、うさぎさんが自信満々に答えを言いました。
「わかったわ！ 秘密のコツは、『お砂糖のかわりに、お塩をひとつまみ入れる』ね！」

「…ぜんぜん違うじゃないか！」
くまたんが叫ぶと、森にはどっと笑いが起こりました。

「さて、探偵さんたち。この間違いは、どこで起こったのかな？」
おばあちゃんの言葉に、みんなは顔を見合わせます。
「それを知るには、どうすればいい？」
「えっと…最後に聞いた、うさぎさんから順番に戻って聞いていく！」
くまたんが答えると、おばあちゃんは満足そうにうなずきました。

「その通り！ AIもまったく同じことをするんじゃ。出力（うさぎさんの答え）から入力（わしの最初の伝言）に向かって、『君のせいで、どれくらい答えがズレたんだい？』と、間違いの責任を一つずつさかのぼって聞いていく。これが、誤差を逆に伝播させる、ということじゃ」

「なるほどー！」
「そして、この伝言ゲームのように、間違いが伝わる原因は、一人だけとは限らんじゃろ？ くまたんもリスくんも、少しずつ聞き間違えたかもしれない。たくさんのニューロン（伝言する人）の中で、『いったい誰が、どれくらい間違いの原因なんだ？』と、責任の所在をはっきりさせるのは、とても難しい問題なんじゃ。これを『**信用割当問題**』という」

おばあちゃんは、地面に伝言ゲームの矢印を描きました。
「AIは、『**連鎖律**』という数学のルールを使って、この一人一人の責任の大きさを、まるでチェーンをたどるように、きっちり計算していくんじゃよ」

「でもね」とおばあちゃんは続けます。
「この伝言ゲームには、危険もひそんでいる。もし、途中のリスくんが、緊張のあまり、もごもごと、蚊の鳴くような声で伝言したらどうなる？」
「最後のうさぎさんには、何も聞こえなくなっちゃうかも…」
「そうじゃ。伝言（誤差の情報）が、途中で消えてなくなってしまう。これが、前に話した『**勾配消失問題**』の正体じゃ。逆もまたしかり。もし最初のくまたんが、はりきって、元の伝言に尾ひれをつけて大声で伝えたら…」
「最後のうさぎさんは、とんでもない勘違いをしちゃう！」
「うむ。伝言がどんどん大げさになって、収拾がつかなくなる。これが『**勾配爆発問題**』。AIの学習がパニックに陥ってしまうんじゃよ」

三人は、AIがただ計算しているだけでなく、まるで名探偵のように、間違いの原因をさかのぼって突き止め、時には伝言ゲームの失敗のように、学習がうまくいかなくなってしまうこともあるのだと知りました。

「誤差逆伝播法…やっぱりすごい必殺技だったんだね！」
くまたんは、AIの健気な探偵姿を想像して、ますますAIのことが好きになるのでした。

（第21話につづく）

## 第21話 坂道コロコロ、賢い一歩

「AI探偵の逆戻り大作戦、すごかったね！」
くまたんの興奮は、まだ冷めやらぬ様子です。
「AIには、ほかにも必殺技があるの？」

「ふふふ、もちろんだとも」
ホワイトタイガーおばあちゃんは、優しくうなずきました。
「たくさんあるが、その中でも一番基本にして、一番奥が深いのが、あの『坂道の下り方』…つまり、**勾配降下法**をどうやって賢く行うか、という『**最適化手法**』なんじゃよ」

「坂道の下り方…おばあちゃんのリハビリ散歩で教えてくれたやつだね！」
「そうじゃ。あの時は、一番低い場所（正解）に向かって、坂道（勾配）を少しずつ下っていくと説明したな。だが、その『一歩』には、実はとても奥深い問題が隠されておる」
おばあちゃんは、みんなに問いかけます。
「もし、みんなが目隠しをして、この坂道を下るとしたら、どんな『一歩』で進むかね？」

「えーっと…」うさぎさんは、少し考えて言いました。
「一歩が大きすぎると、一番低い場所を飛び越えちゃって、また登らないといけなくなるかもしれないわ！」
「逆に、一歩が小さすぎると、時間がかかりすぎて、日が暮れちゃうかも…」
リスくんが、心配そうに続けます。

「その通りじゃ！」
おばあちゃんは、ポンと手を打ちました。
「その『一歩の大きさ』こそが、AIの学習の効率を左右するとても重要な設定、『**学習率**』なんじゃ。大きすぎても、小さすぎてもいけない。ちょうどいい大きさを見つけるのが、まず最初の関門じゃな」

さらに、とおばあちゃんは、近くにある小さなくぼみを指さしました。
「もし、AIがこの小さなくぼみにはまってしまったら、どうなるじゃろう？」
「あっ…！ 周りは全部登り坂だから、『ここが一番低い場所だ！』って勘違いして、動けなくなっちゃう！」
「そう。それが、本当の一番（**大域最適解**）ではない、見せかけの一番にだまされてしまう『**局所最適解**』の問題じゃ」

おばあちゃんは、今度は馬の背中のように、ある方向には下っているけれど、別の方向には上っている、不思議な形の場所を指しました。
「では、ここならどうじゃ？ 坂を下ってきたAIが、この平らな場所に来たら…」
「どっちに進めばいいか、分からなくなっちゃうね…」
「うむ。まるで鞍（くら）の真ん中のようじゃな。ここが『**鞍点**』という、もう一つの厄介なワナじゃ」

局所最適解に、鞍点…。AIの学習の道のりには、たくさんのワナがあることを知り、三人はごくりと唾を飲み込みました。

「じゃあ、AIはどうやってそのワナを乗り越えるの？」
くまたんが尋ねると、おばあちゃんはにっこり笑い、懐からおもむろにドーナツを一つ、取り出しました。
「こういう時はな、勢いをつけるんじゃよ。さあ、このドーナツが、まんまるなボールみたいによく転がるものだと、心の中で想像しておくれ」

おばあちゃんがそう言うと、みんなの心の中では、そのドーナツがまるで意思を持ったかのように、コロコロと坂を転がっていくのが見えました。そして、先ほどの小さなくぼみ（局所最適解）にさしかかりましたが、止まりません。持っていた勢いのまま、くぼみを飛び越え、さらにその先の、もっと低い場所へと転がっていきました。

「おおーっ！」
「この『勢い』が、AIの学習を助ける『**モーメンタム**』という考え方じゃ。これまでの勢いを次の『一歩』に少しだけ足してやることで、小さなくぼみや、平らな場所（鞍点）を乗り越えて、本当のゴールまでたどり着きやすくなるんじゃよ」

三人は、心の中の坂道を賢く転がっていくドーナツの姿に、ワナを乗り越えながら健気に学習を進めるAIの姿を重ねるのでした。

（第22話につづく）

## 【改】第22話 うさぎのクッキー工房と、最高のレシピ探しの旅

「勢いをつけてワナを乗り越えるなんて、AIって、なんだか冒険家みたいだね！」
くまたんが感心していると、うさぎさんがキッチンから、たくさんの試作クッキーと、山のようなレシピのメモを持ってきました。

「ねえ、おばあちゃん！ わたしのクッキー作りも、AIみたいに賢くできないかしら？ 新しいレシピを考えるとき、いつもどうやって味を調整すればいいか、とっても時間がかかっちゃうの」

「ほう、それは最適化手法の、いい練習問題になりそうじゃな」
おばあちゃんは、うなずきました。
「うさぎは今、どうやってレシピを改良しておるんじゃ？」
「えっと…一日中クッキーを焼いて、みんなに食べてもらって、その日の最後に感想をまとめてから、次の日のレシピを考えるの…」
「ふむ。それはAIの学習で言う『**バッチ学習**』じゃな。全部のデータ（感想）を見てから一回だけ学習（レシピ更新）する。安定的じゃが、一日一回しか賢くなれんのが玉にキズじゃ」

「じゃあ、このホログラムみたいに、もっとこまめに勉強したらどうかな？」
くまたんがホログラムペンギンを指さすと、おばあちゃんは悪戯っぽく笑いました。
「それは少し違うが、面白い発想じゃ。『クッキーを一枚焼くたびに感想を聞いて、すぐに次のクッキーのレシピを変える』…これを『**オンライン学習**』、または『**確率的勾配降下法(SGD)**』という。よし、実験じゃ！」

うさぎさんは、さっそく一枚クッキーを焼きました。味見をしたくまたんは「もっと甘いほうがいい！」と言います。うさぎさんは、すぐに砂糖を増やしました。
次のクッキーを食べたリスくんは「甘すぎる！前のほうがいい！」と顔をしかめます。うさぎさんは、慌てて砂糖を減らしました。
これでは、一枚ごとに味が変わりすぎて、美味しいレシピにたどり着けそうにありません。

「うーん、これじゃあお客さんの気まぐれに振り回されて、レシピが迷子になっちゃうわ…」
「そこで、この二つの『いいとこ取り』をするのが『**ミニバッチ学習**』じゃよ。例えば、『10枚一組で焼いて、みんなの感想を聞いてからレシピを更新する』。これなら安定もするし、こまめに賢くなれる。今のAIは、ほとんどこの方法じゃ」
うさぎさんの顔が、ぱっと輝きました。

「そしてな」とおばあちゃんは続けます。
「キッチンにある小麦粉の袋、あれがうさぎの持っている全ての材料（データ）じゃとする。その小麦粉を全部使い切って、クッキーのレシピを完成させるまでが『1**エポック**』じゃ」
「いっぽく？」
「そう。そして、10枚組（ミニバッチ）を焼いてレシピを更新する、その一回一回の反省会が『1**イテレーション**』。つまり、『1エポックの中に、たくさんのイテレーションがある』ということじゃな」

AIの学習の様子が、自分のクッキー作りにそっくりだと知り、うさぎさんは深くうなずきました。
すっかり試食でお腹がいっぱいになったみんなを見て、うさぎさんは「ふふふ、お待たせ！」と、とっておきのランチプレートを運んできました。ふわふわのパン、きのこのスープ、特製のベリージャム。

「わーい、いただきます！」
みんなが夢中でランチを食べていると、おばあちゃんがにっこり笑って言いました。
「AIの最適化手法にはな、『**ノーフリーランチの定理**』という、面白い名前の原則があるんじゃよ」
「えっ、このランチはフリー（無料）なのに？」
「そうじゃ。じゃがAIの世界では、『どんな問題でも解ける、たった一つの最強の万能レシピ（最適化手法）というものは存在しない』という意味での『ただ飯はない』なんじゃ。モーメンタムもすごかったが、他にもAdaGrad、Adamといった、たくさんの賢い工夫がある。問題の特性に合わせて、どの手法が一番いいか、こうして試行錯誤しながら見つけるしかないんじゃよ」

どんな問題にも効く魔法はない。だからこそ、工夫しがいがある。
三人は、美味しいランチに舌鼓を打ちながら、奥深いAIの世界に、思いを馳せるのでした。

（第23話につづく）

## 第23話 最高のオーブンと、AIの最終調整

お腹もいっぱいになり、みんなは再びうさぎさんのキッチンに戻ってきました。
「ノーフリーランチの定理、かぁ。AIのレシピ作りも、やっぱり地道な努力が大事なんだね」
くまたんが言うと、おばあちゃんはにっこり笑いました。

「そうじゃ。じゃが、先人たちはもっと賢い方法をたくさん考えておるよ。さっきの勢いをつける『モーメンタム』の他にもな、『学習率』そのものを自動で調整してくれるすごい仕組みがあるんじゃ」
「えっ、一歩の大きさを自動で！？」
「うむ。『**AdaGrad**』や『**RMSprop**』といった手法は、最初は大きく、だんだん慎重に歩幅を調整してくれる。そして、その二つの良いところを合体させたのが、今の主流である『**Adam**』じゃ。勢いもつけるし、歩幅の調整も上手い。いわば、最高の冒険家じゃな」

「すごい！ どんどん賢くなってるんだね、AIの必殺技も！」
くまたんが興奮していると、うさぎさんは首をかしげました。
「でも、おばあちゃん。最高のレシピ（モデル）と、最高の冒険家（最適化手法）がいても、まだ何か足りない気がするの…」

「おぉ、うさぎ。核心を突いてきたね」
おばあちゃんは、キッチンの隅にある、レンガでできた大きなオーブンを指さしました。
「最高の生地ができても、このオーブンの火加減や焼く時間を間違えたら、クッキーはどうなるかね？」
「こげこげになっちゃう！」
「その通り！ AIの学習で、この『オーブンの設定』にあたるのが、『**ハイパーパラメータ**』なんじゃよ」

「はいぱーぱらめーた？」
「学習率、ミニバッチのサイズ、ドロップアウトの割合…これらは、AIが自分で学習するのではなく、わしらが『これくらいがいいじゃろう』と、事前に決めてやらねばならん設定値なんじゃ。AIを育てるための『環境』と言ってもいい」

「そっかぁ…！ ぼくたちがAIの先生になって、環境を整えてあげるんだね！」
「では、どうやって最高の火加減を見つけるかね？」
おばあちゃんの問いに、うさぎさんは腕を組みます。
「わたしなら…温度を160度、170度、180度って試して、時間も10分、15分、20分って、全部の組み合わせを試してみるわ！」
「それは『**グリッドサーチ**』という、とても丁寧な方法じゃな。最高の組み合わせが見つかるかもしれんが、時間がかかりすぎるのが難点じゃ」

すると、リスくんが言いました。
「ぼくなら、そんな気長なことできないや…勘で、よさそうな組み合わせをいくつか、ぱっぱって試してみる！」
「ふふふ、それも『**ランダムサーチ**』という、立派な方法じゃよ。意外と、それで十分良い設定が見つかることも多いんじゃ」

みんなが最高のオーブン設定に夢中になっていると、くまたんがオーブンの小窓を覗き込んで、叫びました。
「あっ、うさぎさん！ タイマーはまだだけど、クッキーがちょうどいい焼き色になってるよ！」
「ほんとだわ！ 今取り出さないと、焦げちゃう！」

おばあちゃんは、慌ててクッキーを取り出すうさぎさんを見て、満足そうにうなずきました。
「それこそが、最後の極意『**早期終了**』じゃ。テストの点数（訓練誤差）が良くなり続けても、実際の味（汎化性能）が悪くなる前に、ぴたりと学習を止める。過学習を防ぐ、シンプルで強力な技じゃよ」

最高のレシピ、最高の冒-険家、そして最高のオーブン設定。
AIの学習とは、たくさんの工夫を重ねて、たった一つの「最高においしいクッキー」を焼き上げる、長くて楽しい旅なのだと、みんなは知るのでした。

**（第4章 ディープラーニングの概要　おわり）**

（第5章につづく）